<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>テーブル定義変換ツール</title>
  <link rel="stylesheet" href="css/pico.min.css">
  <style>
    body {
      padding: 2rem;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    textarea {
      height: 300px;
      font-family: monospace;
    }
  </style>
</head>

<body>
  <header class="container">
    <h1>テーブル定義変換ツール</h1>
  </header>

  <main class="container">
    <article>
      <section>
        <h2>1. 入力</h2>
        <nav role="tab-control" class="tabs">
          <ul>
            <li><a href="#" data-tab="file-input" class="tab-link active">ファイル入力</a></li>
            <li><a href="#" data-tab="text-input" class="tab-link">テキストエリア入力</a></li>
          </ul>
        </nav>
        <div id="file-input" class="tab-content active">
          <input type="file" id="fileInput">
          <small>TSVまたはCSVファイルを選択してください。</small>
        </div>
        <div id="text-input" class="tab-content">
          <textarea id="textInput" placeholder="ここにTSVまたはCSVデータを貼り付けます"></textarea>
        </div>
      </section>

      <section>
        <h2>2. 変換オプション</h2>
        <fieldset>
          <legend>変換先フォーマット</legend>
          <label><input type="checkbox" id="ddl" name="format" value="ddl" checked> DDL (PostgreSQL)</label>
          <label><input type="checkbox" id="typescript" name="format" value="typescript" checked> TypeScript
            type</label>
          <label><input type="checkbox" id="zod-schema" name="format" value="zod-schema" checked> Zod Schema</label>
          <label><input type="checkbox" id="zod-type" name="format" value="zod-type" checked> TypeScript type from
            Zod</label>
          <label><input type="checkbox" id="java-model" name="format" value="java-model" checked> Java (EBean)
            model</label>
          <label><input type="checkbox" id="java-repo" name="format" value="java-repo" checked> Java repository</label>
          <label><input type="checkbox" id="java-service" name="format" value="java-service" checked> Java
            service</label>
          <label><input type="checkbox" id="java-controller" name="format" value="java-controller" checked> Java
            controller</label>
        </fieldset>
        <fieldset>
          <legend>Java RLS (Row-Level Security) オプション</legend>
          <label>
            <input type="checkbox" id="rlsEnabled" name="rls">
            RLSを有効にする
          </label>
          <div id="rlsOptions" style="display: none;">
            <label for="tenantIdColumn">
              テナントIDカラム名
              <input type="text" id="tenantIdColumn" name="tenantIdColumn" value="tenant_id">
            </label>
            <label for="adminFlagColumn">
              管理者フラグカラム名
              <input type="text" id="adminFlagColumn" name="adminFlagColumn" value="is_admin">
            </label>
          </div>
        </fieldset>
      </section>

      <section>
        <h2>3. 実行</h2>
        <button id="convertBtn">変換実行</button>
      </section>

      <section>
        <h2>4. 結果</h2>
        <nav role="tab-control" class="tabs">
          <ul id="result-tabs">
            <!-- 結果タブがここに追加されます -->
          </ul>
        </nav>
        <div id="result-contents">
          <!-- 結果コンテンツがここに追加されます -->
        </div>
        <button id="downloadAllBtn" style="display: none;">すべてダウンロード (ZIP)</button>
      </section>
      <section id="sql-builder-section" style="display: none;">
        <h2>5. SQL構築</h2>

        <!-- 1. テーブル選択 -->
        <div>
          <h4>1. テーブル選択</h4>
          <div class="grid">
            <select id="sql-table-select">
              <option value="">テーブルを追加...</option>
            </select>
            <button id="sql-add-table-btn" style="width: auto;">追加</button>
          </div>
          <table role="grid">
            <thead>
              <tr>
                <th>Alias</th>
                <th>Table Name</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody id="sql-selected-tables">
            </tbody>
          </table>
        </div>

        <hr>

        <!-- 2. 結合条件 -->
        <div>
          <h4>2. 結合条件</h4>
          <button id="sql-add-join-btn" class="secondary outline" style="margin-bottom: 0.5rem;">結合条件を追加</button>
          <div id="sql-joins-container"></div>
        </div>

        <hr>

        <!-- 3. 絞り込み条件 -->
        <div>
          <h4>3. 絞り込み条件 (WHERE)</h4>
          <button id="sql-add-filter-btn" class="secondary outline" style="margin-bottom: 0.5rem;">条件を追加</button>
          <div id="sql-filters-container"></div>
        </div>

        <hr>

        <!-- 4. ソート順 -->
        <div>
          <h4>4. ソート順 (ORDER BY)</h4>
          <button id="sql-add-sort-btn" class="secondary outline" style="margin-bottom: 0.5rem;">ソートを追加</button>
          <div id="sql-sorts-container"></div>
        </div>

        <hr>

        <!-- 5. 取得カラム -->
        <div>
          <h4>5. 取得カラム (SELECT)</h4>
          <div style="margin-bottom: 0.5rem; font-size: 0.8rem; color: #666;">
            ※テーブルを追加・削除・並べ替えするとリセットされます
          </div>
          <textarea id="sql-select-clause"
            style="height: auto;field-sizing: content;max-height: 90vh; min-height: 100px; font-family: monospace; white-space: pre;"
            oninput="updateSqlOutput()"></textarea>
        </div>

        <hr>

        <!-- 6. 生成結果 -->
        <div>
          <h4>6. 生成結果</h4>
          <button id="sql-copy-btn">クリップボードにコピー</button>
          <textarea id="sql-output" placeholder="生成されたSQLがここに表示されます..."
            style="height: auto;field-sizing: content;max-height: 90vh;"></textarea>
          <button id="sql-generate-java-btn" class="secondary">Javaコード生成</button>
          <div id="sql-java-result-container" style="display: none; margin-top: 1rem;">
            <h5>生成されたJavaコード</h5>
            <nav role="tab-control" class="tabs">
              <ul id="sql-java-tabs"></ul>
            </nav>
            <div id="sql-java-contents"></div>
            <button id="sql-java-download-btn">生成ファイルをダウンロード (ZIP)</button>
          </div>
        </div>
      </section>
    </article>
  </main>

  <!-- <script src="https://cdn.jsdelivr.net/npm/zod@3/lib/index.umd.min.js"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script> -->
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script> -->
  <script src="js/vendor/papaparse.min.js"></script>
  <script src="js/vendor/jszip.min.js"></script>
  <script src="js/vendor/sql-formatter.min.js"></script>
  <script src="js/globals.js"></script>
  <script src="js/utils.js"></script>
  <script src="js/parser.js"></script>
  <script src="js/converters/ddl.js"></script>
  <script src="js/converters/typescript.js"></script>
  <script src="js/converters/zod.js"></script>
  <script src="js/converters/java_model.js"></script>
  <script src="js/converters/java_repo.js"></script>
  <script src="js/converters/java_service.js"></script>
  <script src="js/converters/java_controller.js"></script>
  <script src="js/converters/java_sql.js"></script>
  <script src="js/sql_builder.js"></script>
  <script src="js/main.js"></script>
</body>

</html>