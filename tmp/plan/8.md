# 実装計画: Java ServiceにおけるCSVインポート・エクスポート機能の実装

## 概要

`index.html` の `generateJavaService` 関数を修正し、現在スタブとなっている `exportCsv` と `importCsv` メソッドに完全な実装を生成するロジックを追加する。
これにより、フィルタリングされたデータをCSVとしてダウンロードし、またそのCSVをアップロードして一括登録する機能を提供する。

## 計画

### 1. `generateJavaService` 関数の修正 (`index.html`)

#### 1.1. `exportCsv` メソッドの実装

現在のプレースホルダー実装を、実際にCSVファイルを生成するコードに置き換える。

- **シグネチャの変更**: 検索条件でフィルタリングできるように、`(${modelName} filter)` を引数に追加する。
- **ロジック**:
  1.  `repository.find(filter, 0, Integer.MAX_VALUE)` を呼び出し、対象の全データを取得する。
  2.  ヘッダー行を生成する。各カラムの論理名 (`ColName_JP`) をカンマ区切りで連結する。
  3.  データ行を生成する。取得したモデルのリストをストリーム処理し、各モデルオブジェクトをカンマ区切りの文字列に変換する。
     - 各フィールドの値は `String.valueOf()` で文字列に変換する。
     - カンマを含む値はダブルクォーテーションで囲むなどの基本的なCSVエスケープ処理を考慮する。
  4.  ヘッダー行とデータ行を結合する。
  5.  `Files.createTempFile()` を使用して一時ファイルを作成し、生成したCSVコンテンツを書き込む。
  6.  生成した `File` オブジェクトを返す。
- **追加するインポート**:
  - `java.io.BufferedWriter`
  - `java.io.File`
  - `java.io.IOException`
  - `java.nio.file.Files`
  - `java.util.stream.Collectors`

#### 1.2. `importCsv` メソッドの実装

現在のプレースホルダー実装を、CSVファイルを解析してDBに登録するコードに置き換える。

- **ロジック**:
  1.  `Files.lines()` を使ってCSVファイルを1行ずつ読み込む。
  2.  `skip(1)` でヘッダー行を読み飛ばす。
  3.  各行をカンマで分割 (`line.split(",")`) し、`String[]` の配列にする。
  4.  各配列を新しいモデルオブジェクトに変換する。
     - `new ${modelName}()` でインスタンスを生成。
     - `String[]` の各要素を、対応するモデルのフィールドの型に変換してセッターで設定する。
       - `Long.parseLong()`, `Integer.parseInt()`, `Boolean.parseBoolean()`, `Instant.parse()` など、`mapPostgresToJavaType` の結果に応じた型変換ロジックを生成する。
       - 空文字列の場合は `null` を設定する。
  5.  変換したモデルオブジェクトを `List` に収集する。
  6.  `repository.batchInsert()` を呼び出して、リストを一括でDBに登録する。
  7.  登録した件数を返す。
- **追加するインポート**:
  - `java.io.File`
  - `java.io.IOException`
  - `java.nio.file.Files`
  - `java.util.ArrayList`
  - `java.util.List`
  - `java.util.stream.Collectors`

#### 1.3. (任意) `toCsvRow` ヘルパーメソッドの生成

`exportCsv` 内のロジックが複雑になる場合、モデルオブジェクトをCSVの1行に変換するプライベートヘルパーメソッド `private String toCsvRow(${modelName} model)` を生成することを検討する。これにより、メインロジックが読みやすくなる。

#### 1.4. (任意) `parseCsvValue` ヘルパーメソッドの生成

`importCsv` 内の型変換ロジックが複雑になる場合、CSVの文字列値を適切な型に変換するプライベートヘルパーメソッド `private ${JavaType} parseCsvValue(String value)` を各型ごと、あるいは型を引数に取る形で生成することを検討する。
