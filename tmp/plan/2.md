# Zodスキーマ出力機能の実装計画

## 1. 目的

既存のTypeScript型定義出力機能に加え、Zodライブラリを利用したスキーマ生成機能と、そのスキーマからTypeScriptの型を生成する機能を追加する。

## 2. タスク一覧

### 2.1. ライブラリの追加

- [ ] `index.html` にZodライブラリのCDNリンクを追加する。
  - `https://cdn.jsdelivr.net/npm/zod@3/lib/index.umd.min.js` のような最新版のCDN URLを調査して使用する。

### 2.2. UIの追加・変更

- [ ] `index.html` に以下のUI要素を追加する。
  - [ ] Zodスキーマ生成を実行するボタン (例: "Generate Zod Schema")
  - [ ] ZodスキーマからTypeScriptの型定義を生成するボタン (例: "Generate Type from Zod Schema")
  - [ ] 生成されたZodスキーマを表示するためのテキストエリア
  - [ ] 生成されたTypeScriptの型定義を表示するためのテキストエリア（既存のものを流用または新規追加）

### 2.3. Zodスキーマ生成機能の実装

- [ ] TSV/CSVデータからZodのスキーマ文字列を生成するJavaScript関数を新規に作成する。
  - 入力: `papaparse` でパースされたデータ
  - 処理:
    1. テーブル名からスキーマ名（例: `UserSchema`）を生成する。
    2. 各カラムの情報を元に、Zodの型（`z.string()`, `z.number()`, `z.boolean()` など）を判別するロジックを実装する。
      - 既存の型判別ロジックを参考にする。
      - NULL許容（`optional()`）、デフォルト値（`default()`）なども考慮する。
      - コメント（`description()`）も付与する。
    3. `z.object({...})` の形式でスキーマ全体の文字列を組み立てる。
  - 出力: フォーマットされたZodスキーマの文字列

### 2.4. Zodからの型生成機能の実装

- [ ] Zodスキーマ名から `z.infer` を利用したTypeScriptの型定義文字列を生成するJavaScript関数を新規に作成する。
  - 入力: `papaparse` でパースされたデータ（テーブル名を取得するため）
  - 処理:
    1. テーブル名から型名（例: `User`）とスキーマ名（例: `UserSchema`）を生成する。
    2. `type User = z.infer<typeof UserSchema>;` のような形式の文字列を組み立てる。
  - 出力: TypeScriptの型定義文字列

### 2.5. イベントハンドラの設定

- [ ] 新しく追加したボタンに、対応するJavaScript関数を呼び出すイベントハンドラを紐付ける。
- [ ] 各関数の実行結果を、対応するテキストエリアに表示する処理を実装する。

## 3. その他

- 既存の型定義生成機能とのコードの共通化を検討する（特に型判別ロジック）。
- エラーハンドリングを適切に実装する。
